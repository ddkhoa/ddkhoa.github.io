{"pages":[],"posts":[{"title":"TÃ³m táº¯t 2 nÄƒm sá»­ dá»¥ng NodeJS","text":"Giai Ä‘oáº¡n 1 : Tiáº¿p cáº­n.MÃ¬nh báº¯t Ä‘áº§u sá»­ dá»¥ng NodeJS vÃ o há»c ká»³ 1 nÄƒm 5 Ä‘áº¡i há»c. Ná»n táº£ng láº­p trÃ¬nh Web cá»§a mÃ¬nh trÆ°á»›c khi tiáº¿p cáº­n NodeJS : Vá» thá»±c hÃ nh, thá»±c táº­p vá»›i ASP.NET 1 thÃ¡ng rÆ°á»¡i vÃ o cuá»‘i nÄƒm 3. 2 project PHP á»Ÿ trÆ°á»ng Ä‘áº¡i há»c. Vá» lÃ½ thuyáº¿t, mÃ¬nh náº¯m (sÆ¡ sÆ¡) cÃ¡c khÃ¡i niÃªm cÆ¡ báº£n : client, server, giao thá»©c http. Biáº¿t code HTML, CSS vÃ  JavaScript. Khi tiáº¿p xÃºc vá»›i NodeJS, cáº£m nháº­n Ä‘áº§u tiÃªn cá»§a mÃ¬nh lÃ  nÃ³ dá»… tiáº¿p cáº­n hÆ¡n ASP.NET, thá»±c táº­p nÄƒm 3 cÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng ASP.NET vÃ  tháº¥y nÃ³ hÆ¡i khÃ³ tiáº¿p cáº­n (trÃ¬nh Ä‘á»™ lÃºc Ä‘Ã³ kÃ©m) ngoÃ i ra Visual Studio khÃ¡ náº·ng vÃ  pháº§n cáº¥u hÃ¬nh chá»‰nh chá»‰nh cÃ¡i file xml thÃ¬ hoÃ n toÃ n khÃ´ng hiá»ƒu gÃ¬. Má»™t Ä‘iá»ƒm ná»¯a lÃ  Ä‘á»ƒ thá»±c thi chÆ°Æ¡ng trÃ¬nh (webserver) chá»‰ cáº§n gÃµ 1 lá»‡nh â€œnode app.jsâ€ lÃ  nÃ³ tá»± cháº¡y, khÃ´ng cáº§n pháº£i cÃ i Ä‘áº·t server, pháº§n nÃ y lÃ m mÃ¬nh khÃ¡ thÃ­ch vÃ¬ má»—i láº§n Ä‘á»¥ng Ä‘áº¿n cáº¥u hÃ¬nh hay cÃ i Ä‘áº·t má»™t cÃ¡i gÃ¬ Ä‘Ã³ thÃ¬ mÃ¬nh khÃ¡ e ngáº¡i. Dáº§n dáº§n mÃ¬nh nháº­n ra nhá»¯ng Ä‘iá»ƒm lá»£i khÃ¡c cá»§a NodeJS DÃ¹ng code JS cáº£ frontend vÃ  backend =&gt; khÃ´ng cáº§n pháº£i há»c thÃªm má»™t ngÃ´n ngá»¯ phÃ­a server. Äá»ƒ viáº¿t 1 app Ä‘Æ¡n giáº£n thÃ¬ ráº¥t nhanh, khÃ´ng cáº§n pháº£i thiáº¿t káº¿ class vá»›i cÃ¡c nguyÃªn táº¯c cá»§a láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng. NgoÃ i viá»‡c code logic cá»§a á»©ng dá»¥ng, nhá»¯ng pháº§n cÃ²n láº¡i thÃ¬ háº§u háº¿t Ä‘á»u cÃ³ má»™t module trÃªn npm cÃ³ thá»ƒ cÃ i Ä‘áº·t vÃ  sá»­ dá»¥ng ráº¥t dá»… dÃ ng, tá»« quáº£n lÃ½ session, cho phÃ©p request cross domain,â€¦ vÃ  nhiá»u chá»©c nÄƒng khÃ¡c. MÃ¬nh cáº£m tháº¥y ráº¥t tiá»‡n. (Pháº§n nÃ y mÃ¬nh khÃ´ng cÃ³ Ã½ dÃ¬m hÃ ng cÃ¡c cÃ´ng nghá»‡ khÃ¡c, quan Ä‘iá»ƒm cÃ¡ nhÃ¢n lÃ  vá»›i má»™t ngÆ°á»i khÃ´ng cÃ³ nhiá»u kinh nghiá»‡m vá» web thÃ¬ NodeJS khÃ¡ lÃ  dá»… tiáº¿p cáº­n) Giai Ä‘oáº¡n 2 : Gáº·p ráº¯c rá»‘i.Sau khi há»c NodeJS Ä‘Æ°á»£c 1 há»c ká»³, báº¯t Ä‘áº§u Ä‘i thá»±c táº­p vÃ  sá»­ dá»¥ng NodeJS. á» giai Ä‘oáº¡n nÃ y, mÃ¬nh váº«n dÃ¹ng style code Ä‘Æ°á»£c há»c trÃªn trÆ°á»ng Ä‘á»ƒ viáº¿t code. CÃ´ng ty mÃ¬nh thá»±c táº­p lÃ  1 startup, mÃ¬nh Ä‘Æ°á»£c giao cÃ´ng viá»‡c vÃ  hÆ°á»›ng dáº«n khi gáº·p khÃ³ khÄƒn, má»¥c tiÃªu lÃ  hoÃ n thÃ nh sáº£n pháº©m nhanh chÃ³ng nÃªn khÃ´ng cÃ³ nhiá»u code review. MÃ¬nh code khÃ¡ tá»± do. BÃ¢y giá» nhÃ¬n láº¡i thÃ¬ tháº¥y thiáº¿u sÃ³t cá»§a mÃ¬nh á»Ÿ giai Ä‘oáº¡n nÃ y lÃ  khÃ´ng lÃªn máº¡ng tÃ¬m hiá»ƒu xem ngÆ°á»i ta Ä‘ang sá»­ dá»¥ng NodeJS nhÆ° tháº¿ nÃ o. Theo thá»i gian, nhá»¯ng chá»©c nÄƒng Ä‘Æ°á»£c thÃªm vÃ o, project ngÃ y cÃ ng lá»›n dáº§n lÃªn. Má»‘i liÃªn há»‡ giá»¯a cÃ¡c thÃ nh pháº§n trong project ngÃ y cÃ ng trá»Ÿ nÃªn rá»‘i ráº¯m hÆ¡n.MÃ¬nh cáº£m tháº¥y project cá»§a mÃ¬nh khÃ´ng cÃ³ má»™t chuáº©n, qui táº¯c nÃ o, vÃ  báº¯t Ä‘áº§u trá»Ÿ nÃªn khÃ³ quáº£n lÃ½ theo thá»i gian. á» má»©c tháº¥p hÆ¡n, code nhÃ¬n xáº¥u vá»›i nhiá»u hÃ m callback lá»“ng nhau. MÃ¬nh báº¯t Ä‘áº§u tÃ¬m hiá»ƒu trÃªn máº¡ng nhá»¯ng â€œbest practicesâ€ cho NodeJS (vÃ  cáº£ nhá»¯ng váº¥n Ä‘á» khÃ¡c liÃªn quan tá»›i viá»‡c viáº¿t API). MÃ¬nh tÃ¬m tháº¥y trang https://github.com/goldbergyoni/nodebestpractices táº­p há»£p ráº¥t nhiá»u nhá»¯ng Â« best practices Â» há»¯u Ã­ch khi lÃ m viá»‡c vá»›i NodeJS. Tá»« cáº¥u trÃºc project, xá»­ lÃ½ lá»—i, cÃ¡ch viáº¿t code,â€¦ táº¥t cáº£ Ä‘á»u Ä‘Æ°á»£c táº­p há»£p trong má»™t link duy nháº¥t, má»™t link duy nháº¥t ğŸ˜Š. Khi xem cÃ¡c bÃ i viáº¿t trong trang nÃ y, mÃ¬nh tháº¥y code cá»§a mÃ¬nh Ä‘á»¥ng Ä‘áº¿n khÃ¡ nhiá»u nhá»¯ng Ä‘iá»ƒm sai sÃ³t, nhá»¯ng Ä‘iá»ƒm lá»›n mÃ  mÃ¬nh nhá»› lÃ  : Cáº¥u trÃºc project theo lá»›p : mÃ¬nh chia file theo lá»›p, lá»›p route, lá»›p logic vÃ  lá»›p access database. Tháº­t ra lÃºc ban Ä‘áº§u mÃ¬nh khÃ´ng há» nháº­n ra Ä‘iá»u nÃ y, chá»‰ sau khi project lá»›n dáº§n lÃªn vÃ  mÃ¬nh liÃªn tá»¥c pháº£i kÃ©o chuá»™t lÃªn xuá»‘ng Ä‘á»ƒ tÃ¬m file thÃ¬ tháº¥y ráº¥t báº¥t tiá»‡n Callback hell : ban Ä‘áº§u mÃ¬nh sá»­ dá»¥ng callback, Ä‘Ã¢y lÃ  cÃ¡ch mÃ¬nh Ä‘Æ°á»£c há»c trong trÆ°á»ng. LÃºc Ä‘Ã³ mÃ¬nh dÃ¹ng callback thÃ¬ cÅ©ng khÃ´ng cáº£m tháº¥y cÃ³ váº¥n Ä‘á» gÃ¬. Cho Ä‘áº¿n khi project cá»§a mÃ¬nh ngÃ y cÃ ng cÃ³ nhiá»u business phá»©c táº¡p thÃ¬ má»™t hÃ m cá»§a mÃ¬nh chá»©a ráº¥t nhiá»u callback, mÃ  má»—i láº§n callback thÃ¬ code nÃ³ bá»‹ thá»¥t vÃ o trong nÃªn ráº¥t khÃ³ coi. Äá»‰nh Ä‘iá»ƒm mÃ¬nh nhá»› cÃ³ má»™t hÃ m nÃ³ tá»¥t vÃ o gáº§n giá»¯a trang code Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng NodeJS vÃ  lÃ m 2 Ä‘iá»u nÃ y thÃ¬ nÃªn thay Ä‘á»•i ngay, Ä‘á»«ng nhÆ° mÃ¬nh ğŸ˜Š VÃ  cÃ²n nhiá»u Ä‘iá»ƒm khÃ¡c, ngoÃ i ra project mÃ¬nh cÃ²n cÃ³ nhá»¯ng lá»—i sau, liÃªn quan tá»›i viá»‡c viáº¿t API : Vá» viá»‡c sá»­ dá»¥ng phÆ°Æ¡ng thá»©c httpThá»i gian Ä‘Ã³ project cá»§a mÃ¬nh chá»‰ cÃ³ 2 method : get vÃ  post. Get Ä‘á»ƒ láº¥y thÃ´ng tin tá»« server, Post Ä‘á»ƒ server lÃ m gÃ¬ Ä‘Ã³ vá»›i thÃ´ng tin Ä‘Æ°á»£c post. MÃ¬nh lÃªn máº¡ng tÃ¬m hiá»ƒu cÃ¡c phÆ°Æ¡ng thá»©c cá»§a http, ngoÃ i get vÃ  post cÃ²n cÃ³ put, delete, head, optionâ€¦ Sau Ä‘Ã³ mÃ¬nh nghiÃªn cá»©u vÃ  sá»­ dá»¥ng thÃªm put vÃ  delete. Vá» viá»‡c Ä‘áº·t tÃªn cho APIThá»i gian Ä‘áº§u Ä‘i lÃ m mÃ¬nh hay Ä‘áº·t tÃªn api dáº¡ng /createuser, /modifyuser, /deleteuserSau khi tÃ¬m Ä‘á»c vá» cÃ¡ch Ä‘áº·t tÃªn API, mÃ¬nh rÃºt ra má»™t bÃ i há»c lÃ  khÃ´ng nÃªn Ä‘á»ƒ cÃ¡c Ä‘á»™ng tá»« nhÆ° create/modify/delete/get vÃ o trong api, tÃªn phÆ°Æ¡ng thá»©c http sáº½ thá»ƒ hiá»‡n thÃ´ng tin Ä‘Ã³. VÃ­ dá»¥ : 12345Get /users/id : get user báº±ng idGet /users?query: get nhiá»u users, cÃ³ thá»ƒ sá»­ dá»¥ng queryPost /users : táº¡o má»™t userPut /user : update thÃ´ng tin má»™t userDelete /user : xÃ³a user Theo cÃ¡ch nÃ y tÃªn cá»§a cÃ¡c api sáº½ Ä‘Æ¡n giáº£n vÃ  nháº¥t quÃ¡n hÆ¡n. Giai Ä‘oáº¡n 3 : Cáº­p nháº­t kiáº¿n thá»©c má»›iLáº¡i nÃ³i vá» project NodeJS cá»§a mÃ¬nh, táº¡i thá»i Ä‘iá»ƒm Ä‘á»c Ä‘Æ°á»£c nhá»¯ng best practices thÃ¬ project nÃ y cÅ©ng Ä‘Ã£ tÆ°Æ¡ng Ä‘á»‘i to Ä‘á»ƒ mÃ¬nh cÃ³ thá»ƒ refactor nÃªn mÃ¬nh khÃ´ng refactor code cÅ©. Tuy nhiÃªn mÃ¬nh sáº½ viáº¿t nhá»¯ng code má»›i theo cÃ¡c best practices Ä‘Ã£ Ä‘á»c. TÆ°Æ¡ng á»©ng vá»›i 2 (trong sá»‘ ráº¥t nhiá»u) lá»—i mÃ  mÃ¬nh Ä‘Ã£ pháº¡m á»Ÿ giai Ä‘oáº¡n 2, mÃ¬nh Ã¡p dá»¥ng kiáº¿n thá»©c má»›i. Cáº¥u trÃºc project : vá»›i má»™t tÃ­nh nÄƒng má»›i Ä‘Æ°á»£c thÃªm vÃ o project, mÃ¬nh sáº½ táº¡o má»™t thÆ° má»¥c má»›i chá»©a toÃ n bá»™ file liÃªn quan Ä‘áº¿n tÃ­nh nÄƒng Ä‘Ã³ á»Ÿ cÃ¡c táº§ng khÃ¡c nhau. VÃ­ dá»¥, khi thÃªm tÃ­nh nÄƒng quáº£n lÃ½ ngÆ°á»i dÃ¹ng thÃ¬ mÃ¬nh sáº½ táº¡o má»™t thÆ° má»¥c user chá»©a cÃ¡c file : user.service, user.data, user.test, user.route. Coding style : mÃ¬nh sá»­ dá»¥ng async/await. 2 tá»« khÃ³a nÃ y giÃºp viá»‡c viáº¿t code báº¥t Ä‘á»“ng bá»™ trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n nhiá»u. Code báº¥t Ä‘á»“ng bá»™ sá»­ dá»¥ng 2 tá»« khÃ³a nÃ y trÃ´ng giá»‘ng y nhÆ° má»™t Ä‘oáº¡n code Ä‘á»“ng bá»™ thÃ´ng thÆ°á»ng. Tá»›i thá»i Ä‘iá»ƒm nÃ y, sau 2 nÄƒm sá»­ dá»¥ng NodeJS, mÃ¬nh thá»±c hiá»‡n má»™t project nho nhá» Ä‘á»ƒ cÃ i Ä‘áº·t táº¥t cáº£ nhá»¯ng best practices mÃ  mÃ¬nh tháº¥y há»¯u dá»¥ng nháº¥t vÃ  sá»­ dá»¥ng nÃ³ nhÆ° má»™t template cho cÃ¡c project NodeJS sau nÃ y cá»§a mÃ¬nh. Nhá»¯ng best practices Ä‘Ã³ lÃ  : Chia project theo chá»©c nÄƒng (nhÆ° mÃ¬nh Ä‘Ã£ nÃ³i á»Ÿ trÃªn). NgÄƒn cÃ¡ch rÃµ cÃ¡c táº§ng trong project.VÃ­ dá»¥, náº¿u á»Ÿ táº§ng route mÃ¬nh truyá»n tháº³ng 2 biáº¿n req vÃ  res vÃ o táº§ng business thÃ¬ mÃ¬nh Ä‘Ã£ táº¡o ra sá»± phá»¥ thuá»™c cá»§a táº§ng business vÃ o táº§ng route. Äiá»u nÃ y lÃ m cho viá»‡c test code business trá»Ÿ nÃªn khÃ³ khÄƒn. Thay vÃ o Ä‘Ã³, táº¡i táº§ng route, mÃ¬nh chá»‰ lá»±a nhá»¯ng trÆ°á»ng nÃ o cáº§n thiáº¿t Ä‘á»ƒ truyá»n vÃ o, thÆ°Æ¡ng lÃ  cÃ¡c trÆ°á»ng trong req.body hoáº·c lÃ  req.params.Má»™t Ä‘iá»ƒm mÃ  mÃ¬nh hay tháº¥y á»Ÿ cÃ¡c project NodeJS trÃªn Github lÃ , táº¡i táº§ng model, há» sáº½ export ra model Ä‘á»ƒ táº§ng Business sá»­ dá»¥ng. Táº§ng business cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c method find, findOne, findOneAndUpdate Ä‘Æ°á»£c xÃ¢y dá»±ng sáºµn trong thÆ° viá»‡n Mongoose. Suy nghÄ© cá»§a mÃ¬nh cÃ³ hÆ¡i khÃ¡c, mÃ¬nh sáº½ viáº¿t cÃ¡c hÃ m truy xuáº¥t dá»¯ liá»‡u táº¡i táº§ng model. MÃ¬nh tháº¥y cÃ³ 2 Ä‘iá»ƒm lá»£i chÃ­nh Ä‘á»ƒ mÃ¬nh giá»¯ cÃ¡ch viáº¿t nÃ y máº·c dÃ¹ nhÃ¬n khÃ¡ thá»«a thÃ£i vÃ  tá»‘n cÃ´ng code. Thá»© nháº¥t, náº¿u api cá»§a Mongoose cÃ³ sá»± thay Ä‘á»•i thÃ¬ mÃ¬nh chá»‰ thay Ä‘á»•i trong táº§ng model Thá»© hai, mÃ¬nh giá»›i háº¡n Ä‘Æ°á»£c nhá»¯ng method mÃ  táº§ng Business cÃ³ thá»ƒ sá»­ dá»¥ng Sá»­ dá»¥ng thÆ° viá»‡n logger thay cho console.logConsole.log ráº¥t quan trá»ng vÃ¬ nÃ³ cung cáº¥p thÃ´ng tin cá»§a chÆ°Æ¡ng trÃ¬nh. Console.log nhá»¯ng Ä‘iá»ƒm quan trá»ng trong chÆ°Æ¡ng trÃ¬nh vá»›i má»™t style rÃµ rÃ ng giÃºp Ã­ch ráº¥t nhiá»u trong quÃ¡ trÃ¬nh debug cÅ©ng nhÆ° phÃ¡t hiá»‡n Ä‘iá»u báº¥t thÆ°á»ng khi server hoáº¡t Ä‘á»™ng. Viáº¿t unit testTheo sÃ¡ch clean code, test enables all the -ilities. VÃ¬ nÃ³ cho phÃ©p chÃºng ta thay Ä‘á»•i, chá»‰nh sá»­a code. Má»™t ngÃ y nÃ o Ä‘Ã³ báº¡n tháº¥y coding style ráº¥t lÃ  xáº¥u vÃ  báº¡n muá»‘n refactor, hoáº·c má»™t tÃ­nh nÄƒng nÃ o Ä‘Ã³ trong chÆ°Æ¡ng trÃ¬nh cáº§n pháº£i cáº­p nháº­t theo yÃªu cáº§u má»›i. Náº¿u báº¡n cÃ³ sáºµn cÃ¡c test thÃ¬ viá»‡c thay Ä‘á»•i code sáº½ khÃ´ng lÃ m báº¡n lo láº¯ng xem nÃ³ cÃ³ áº£nh hÆ°á»Ÿng tá»›i nhá»¯ng pháº§n khÃ¡c cá»§a chÆ°Æ¡ng trÃ¬nh hay khÃ´ng. Chá»‰ cáº§n vÆ°á»£t qua cÃ¡c test lÃ  xong ğŸ˜Š. Cáº¥u trÃºc apiNáº¿u mÃ¬nh sá»­ dá»¥ng cÃ¡c api viáº¿t trong file user.route vá»›i prefix /users thÃ¬ trong file nÃ y thay vÃ¬ pháº£i viáº¿t /users/id mÃ¬nh chá»‰ cáº§n viáº¿t /id. Äiá»u nÃ y cho phÃ©p mÃ¬nh cÃ³ má»™t cáº¥u trÃºc api nhiá»u táº§ng (nhiá»u /) vÃ  trÃ¡nh sá»± láº·p láº¡i khÃ´ng cáº§n thiáº¿t. ChiÃªm nghiá»‡mLÃ½ do mÃ¬nh viáº¿t bÃ i nÃ y lÃ  vÃ¬ má»™t cÃ¢u nÃ³i cá»§a chÃº Nguyá»…n Há»¯u ThÃ¡i HÃ²a trong má»™t video mÃ¬nh coi trÃªn youtube. â€œHá»c thÃ¬ há»c ráº¥t nhiá»u nhÆ°ng mÃ  ngá»™ (wisdom) ra Ä‘Æ°á»£c cÃ¡i gÃ¬ má»›i lÃ  quan trá»ngâ€. MÃ¬nh viáº¿t bÃ i nÃ y Ä‘á»ƒ Ä‘Ã³ng gÃ³i láº¡i 2 nÄƒm sá»­ dá»¥ng NodeJS, tá»« giai Ä‘oáº¡n tiáº¿p cáº­n, tá»›i nhá»¯ng ráº¯c rá»‘i cho Ä‘áº¿n viá»‡c cáº­p nháº­t kiáº¿n thá»©c má»›i Ä‘á»ƒ sá»­ dá»¥ng cÃ´ng nghá»‡ nÃ y â€œchuáº©nâ€ hÆ¡n. Cáº§n pháº£i nÃ³i má»™t Ä‘iá»u, giai Ä‘oáº¡n 2 vÃ  3 á»Ÿ bÃªn trÃªn diá»…n ra tuáº§n hoÃ n chá»› khÃ´ng tuáº§n tá»±. Khi mÃ¬nh suy nghÄ© tá»›i nhá»¯ng cÃ´ng nghá»‡ khÃ¡c mÃ¬nh sá»­ dá»¥ng khi Ä‘i lÃ m : AngularJS vÃ  MongoDB, bá»—ng nhiÃªn mÃ¬nh tháº¥y cÃ³ nhá»¯ng Ä‘iá»ƒm hoÃ n toÃ n tÆ°Æ¡ng tá»± vá»›i NodeJS. MÃ¬nh cÅ©ng báº¯t Ä‘áº§u tiáº¿p cáº­n cÃ¡c cÃ´ng nghá»‡ nÃ y vá»›i sá»± há»©ng khá»Ÿi vÃ¬ chÃºng cÃ³ nhá»¯ng Ä‘iá»ƒm tá»‘t hÆ¡n so vá»›i nhá»¯ng thá»© mÃ¬nh Ä‘Ã£ sá»­ dá»¥ng trÆ°á»›c Ä‘Ã³ (JS thuáº§n vá»›i AngularJS, MySQL vá»›i MongoDB) sau Ä‘Ã³ gáº·p ráº¯c rá»‘i trong quÃ¡ trÃ¬nh sá»­ dá»¥ng vÃ  rá»“i láº¡i cáº­p nháº­t kiáº¿n thá»©c má»›i Ä‘á»ƒ giáº£i quyáº¿t nhá»¯ng ráº¯c rá»‘i gáº·p pháº£i. MÃ¬nh rÃºt ra má»™t káº¿t luáº­n mÃ  ai cÅ©ng biáº¿t Ä‘Ã³ lÃ  viá»‡c há»c há»i, cáº­p nháº­t cÃ¡i má»›i cáº§n diá»…n ra má»™t cÃ¡ch liÃªn tá»¥c. NhÆ°ng giá», vá»›i nhá»¯ng gÃ¬ mÃ¬nh Ä‘Ã£ tráº£i qua, mÃ¬nh Ä‘Ã£ hiá»ƒu sÃ¢u sáº¯c lÃ½ do cá»§a viá»‡c Ä‘Ã³. Náº¿u chÃºng ta khÃ´ng cáº­p nháº­t cÃ¡i má»›i thÃ¬ sá»›m muá»™n chÃºng ta sáº½ â€œgáº·p ráº¯c rá»‘iâ€.Tháº¿ cÃ¡i nÃ y mÃ  Ä‘em vÃ o chuyá»‡n hÃ´n nhÃ¢n gia Ä‘Ã¬nh thÃ¬ sao nhá»‰ ? :D. CÃ¡c báº¡n tá»± cÃ³ cÃ¢u tráº£ lá»i há»£p lÃ½ nhÃ© :v.","link":"/2019/11/03/2namnodejs/"},{"title":"SSH - Kiáº¿n thá»©c cÄƒn báº£n vÃ  á»©ng dá»¥ng","text":"Má»¥c Ä‘Ã­ch bÃ i viáº¿tTrong quÃ¡ trÃ¬nh Ä‘i lÃ m cá»§a mÃ¬nh, ngoÃ i viá»‡c viáº¿t code, má»™t hoáº¡t Ä‘á»™ng khÃ¡c chiáº¿m khÃ¡ nhiá»u thá»i gian lÃ  viá»‡c Ä‘áº©y code lÃªn remote repository, hay deploy code lÃªn server. Khi lÃ m viá»‡c vá»›i git hay server, chÃºng ta khÃ´ng thá»ƒ khÃ´ng nháº¯c tá»›i thuáº­t ngá»¯ SSH. BÃ i viáº¿t nÃ y cá»§a mÃ¬nh nháº±m má»¥c Ä‘Ã­ch há»‡ thá»‘ng láº¡i cÃ¡c kiáº¿n thá»©c liÃªn quan Ä‘áº¿n SSH, tá»« pháº§n kiáº¿n thá»©c ná»n táº£ng, tá»›i cÃ¡c viá»‡c sá»­ dá»¥ng SSH trong thá»±c táº¿. Giá»›i thiá»‡u SSHKhi lÃ m viá»‡c vá»›i server, ta cáº§n má»™t phÆ°Æ¡ng thá»©c cho phÃ©p ta káº¿t ná»‘i vá»›i server tá»« mÃ¡y tÃ­nh cá»§a mÃ¬nh. SSH lÃ  má»™t trong nhá»¯ng phÆ°Æ¡ng thá»©c Ä‘Ã³. SSH lÃ  phÆ°Æ¡ng thá»©c giÃºp chÃºng ta thiáº¿t láº­p má»™t káº¿t ná»‘i báº£o máº­t tá»›i server tá»« xa. Káº¿t ná»‘i nÃ y cho phÃ©p báº¡n lÃ m viá»‡c trá»±c tiáº¿p vá»›i shell cá»§a server. Tá»« Ä‘Ã³ báº¡n cÃ³ thá»ƒ lÃ m viá»‡c vá»›i server giá»‘ng nhÆ° Ä‘ang lÃ m vá»›i mÃ¡y cá»§a mÃ¬nh. Váº­y lÃ  xong pháº§n Ä‘á»‹nh nghÄ©a. BÃ¢y giá» mÃ¬nh xin phÃ©p Ä‘iá»ƒm láº¡i má»™t sá»‘ kiáº¿n thá»©c cÆ¡ báº£n trÆ°á»›c khi báº¯t Ä‘áº§u thá»±c hÃ nh sá»­ dá»¥ng cÃ´ng cá»¥ nÃ y. Pháº§n nÃ y sáº½ giÃºp chÃºng ta hiá»ƒu rÃµ Ã½ nghÄ©a cá»§a má»™t file config hay má»™t thÃ´ng bÃ¡o lá»—iâ€¦ tá»« Ä‘Ã³ biáº¿t/hiá»ƒu mÃ¬nh cáº§n pháº£i lÃ m gÃ¬ ngay cáº£ khi copy code trÃªn máº¡ng. Kiáº¿n thá»©c ná»n : MÃ£ hÃ³aá» pháº§n trÃªn, chÃºng ta Ä‘Ã£ nháº¯c Ä‘áº¿n báº£o máº­t. SSH cho phÃ©p ta thiáº¿t láº­p má»™t káº¿t ná»‘i báº£o máº­t. Äá»ƒ thá»±c hiá»‡n Ä‘iá»u Ä‘Ã³, SSH sá»­ dá»¥ng cÃ¡c thuáº­t toÃ¡n mÃ£ hÃ³a khÃ¡c nhau. Trong pháº§n nÃ y mÃ¬nh xin nháº¯c láº¡i cÃ¡c khÃ¡i niá»‡m mÃ£ hÃ³a, mÃ£ hÃ³a Ä‘á»‘i xá»©ng, mÃ£ hÃ³a phi Ä‘á»‘i xá»©ng. MÃ£ hÃ³a MÃ£ hÃ³a lÃ  viá»‡c diá»…n Ä‘áº¡t má»™t thÃ´ng tin theo dáº¡ng khÃ´ng thá»ƒ hiá»ƒu Ä‘Æ°á»£c trá»« khi báº¡n cÃ³ phÆ°Æ¡ng tiá»‡n Ä‘á»ƒ giáº£i mÃ£. MÃ£ hÃ³a Ä‘áº£m báº£o sá»± an toÃ n, báº£o máº­t cho viá»‡c trao Ä‘á»•i thÃ´ng tin giá»¯a 2 bÃªn. CÃ¡c thuáº­t toÃ¡n mÃ£ hÃ³a cÃ³ thá»ƒ Ä‘Æ°á»£c chia ra thÃ nh 2 lá»›p : mÃ£ hÃ³a Ä‘á»‘i xá»©ng vÃ  mÃ£ hÃ³a phi Ä‘á»‘i xá»©ng. MÃ£ hÃ³a Ä‘á»‘i xá»©ngMÃ£ hÃ³a Ä‘á»‘i xá»©ng lÃ  má»™t lá»›p cÃ¡c thuáº­t toÃ¡n mÃ£ hÃ³a mÃ  trong Ä‘Ã³ viá»‡c mÃ£ hÃ³a vÃ  giáº£i mÃ£ thÃ´ng tin chung má»™t khÃ³a (giáº£i mÃ£ lÃ  quÃ¡ trÃ¬nh ngÆ°á»£c láº¡i cá»§a mÃ£ hÃ³a). KhÃ³a nÃ y cáº§n Ä‘Æ°á»£c báº£o vá»‡. MÃ£ hÃ³a Ä‘á»‘i xá»©ng giÃºp cho thÃ´ng tin Ä‘Æ°á»£c trao Ä‘á»•i Ä‘Æ°á»£c giá»¯ bÃ­ máº­t. Chá»‰ nhá»¯ng ngÆ°á»i cÃ³ khÃ³a má»›i cÃ³ thá»ƒ giáº£i mÃ£ thÃ´ng tin. MÃ£ hÃ³a phi Ä‘á»‘i xá»©ngTrÃ¡i ngÆ°á»£c vá»›i mÃ£ hÃ³a Ä‘á»‘i xá»©ng, cÃ¡c thuáº­t toÃ¡n mÃ£ hÃ³a phi Ä‘á»‘i xá»©ng sá»­ dá»¥ng 2 khÃ³a khÃ¡c nhau Ä‘á»ƒ mÃ£ hÃ³a vÃ  giáº£i mÃ£ thÃ´ng tin. Má»—i ngÆ°á»i cáº§n cÃ³ má»™t cáº·p khÃ³a. Trong Ä‘Ã³, khÃ³a cÃ´ng khai cÃ³ thá»ƒ cÃ´ng khai cho má»i ngÆ°á»i, cÃ²n khÃ³a bÃ­ máº­t thÃ¬ cá»§a riÃªng má»—i ngÆ°á»i vÃ  khÃ´ng Ä‘Æ°á»£c chia sáº» cho báº¥t cá»© ai. Khi thÃ´ng tin Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng má»™t khÃ³a nÃ o Ä‘Ã³ trong cáº·p khÃ³a thÃ¬ chá»‰ cÃ³ duy nháº¥t khÃ³a cÃ²n láº¡i trong cÃ¹ng má»™t cáº·p má»›i cÃ³ thá»ƒ giáº£i mÃ£. MÃ£ hÃ³a phi Ä‘á»‘i xá»©ng cÅ©ng cung cáº¥p cho chÃºng ta kháº£ nÄƒng báº£o máº­t thÃ´ng tin giá»‘ng nhÆ° mÃ£ hÃ³a Ä‘á»‘i xá»©ng. Náº¿u bÃªn A mÃ£ hÃ³a tin nháº¯n báº±ng khÃ³a cÃ´ng khai cá»§a bÃªn B thÃ¬ chá»‰ cÃ³ duy nháº¥t bÃªn B vá»›i khÃ³a bÃ­ máº­t cá»§a mÃ¬nh má»›i cÃ³ thá»ƒ giáº£i mÃ£. NgoÃ i ra, nÃ³ cÃ²n 2 kháº£ nÄƒng sau mÃ  mÃ£ hÃ³a Ä‘á»‘i xá»©ng khÃ´ng cÃ³ : GiÃºp ta xÃ¡c nháº­n ai lÃ  ngÆ°á»i gá»Ÿi thÃ´ng tin. (*) NgÆ°á»i Ä‘Ã£ gá»Ÿi thÃ´ng tin khÃ´ng thá»ƒ chá»‘i bá» hÃ nh Ä‘á»™ng cá»§a mÃ¬nh ÄÃ¢y lÃ  trÆ°á»ng há»£p khi bÃªn A mÃ£ hÃ³a tin nháº¯n báº±ng khÃ³a bÃ­ máº­t cá»§a chÃ­nh mÃ¬nh. BÃªn B dÃ¹ng khÃ³a cÃ´ng khai cá»§a bÃªn A Ä‘á»ƒ giáº£i mÃ£. Náº¿u giáº£i mÃ£ thÃ nh cÃ´ng chá»©ng tá» tin nháº¯n chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»Ÿi Ä‘i tá»« bÃªn A. Äá»“ng thá»i, bÃªn A cÅ©ng khÃ´ng thá»ƒ chá»‘i bá» ráº±ng mÃ¬nh Ä‘Ã£ gá»Ÿi tin nháº¯n nÃ y vÃ¬ náº¿u lÃ  má»™t ai khÃ¡c gá»Ÿi thÃ¬ bÃªn B khÃ´ng thá»ƒ dÃ¹ng khÃ³a cÃ´ng khai cá»§a bÃªn A Ä‘á»ƒ giáº£i mÃ£. TÃ­nh cháº¥t (*) lÃ  má»™t cÆ¡ sá»Ÿ quan trá»ng cho SSH, vÃ¬ nÃ³ giÃºp server xÃ¡c thá»±c ai lÃ  ngÆ°á»i Ä‘ang káº¿t ná»‘i vá»›i há»‡ thá»‘ng. Äiá»u nÃ y cho phÃ©p server cÃ³ thá»ƒ cháº¥p nháº­n hoáº·c tá»« chá»‘i káº¿t ná»‘i. QuÃ¡ trÃ¬nh xÃ¡c thá»±c sá»­ dá»¥ng SSH khÃ´ng yÃªu cáº§u máº­t kháº©u, thay vÃ o Ä‘Ã³ khÃ³a bÃ­ máº­t sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng cÃ¹ng vá»›i cÃ¡c khÃ³a cÃ´ng khai Ä‘Æ°á»£c cho phÃ©p (authorized_keys) trÃªn server. So sÃ¡nh 2 phÆ°Æ¡ng phÃ¡p xÃ¡c thá»±c báº±ng máº­t kháº©u vÃ  báº±ng khÃ³a bÃ­ máº­t, ta tháº¥y ráº±ng : XÃ¡c thá»±c báº±ng khÃ³a bÃ­ máº­t cho phÃ©p ta tá»± Ä‘á»™ng hÃ³a cÃ¡c cÃ¢u lá»‡nh vÃ¬ server shell khÃ´ng yÃªu cáº§u nháº­p máº­t kháº©u. XÃ¡c thá»±c báº±ng khÃ³a bÃ­ máº­t cho ta biáº¿t ai lÃ  ngÆ°á»i truy cáº­p há»‡ thá»‘ng. Vá»›i máº­t kháº©u, ngÆ°á»i Ä‘Äƒng nháº­p vÃ o há»‡ thá»‘ng chá»‰ lÃ  má»™t ngÆ°á»i nÃ o Ä‘Ã³ biáº¿t máº­t kháº©u. Vá»›i viá»‡c khÃ´ng sá»­ dá»¥ng máº­t kháº©u, xÃ¡c thá»±c báº±ng khÃ³a bÃ­ máº­t an toÃ n hÆ¡n. Má»—i ngÆ°á»i trong má»™t nhÃ³m cÃ³ thá»ƒ dÃ¹ng khÃ³a bÃ­ máº­t cá»§a riÃªng mÃ¬nh Ä‘á»ƒ Ä‘Äƒng nháº­p vÃ o há»‡ thá»‘ng chung thay vÃ¬ chia sáº» vá»›i nhau má»™t máº­t kháº©u. ÄÃ³ cÅ©ng chÃ­nh lÃ  nhá»¯ng Ä‘iá»ƒm máº¡nh cá»§a SSH. BÃ¢y giá», chÃºng ta sáº½ nÃ³i vá» viá»‡c sá»­ dá»¥ng SSH trong thá»±c táº¿. Sá»­ dá»¥ng SSH khi Ä‘i lÃ mSá»­ dá»¥ng SSH vá»›i Git hosting serviceKhi lÃ m viá»‡c vá»›i git hosting service nhÆ° GitHub, chÃºng ta cÃ³ thá»ƒ clone, push, pull.. má»™t repository sá»­ dá»¥ng giao thá»©c HTTPS hoáº·c SSH. Náº¿u sá»­ dá»¥ng HTTPS, má»—i khi push, pull .. chÃºng ta cáº§n pháº£i nháº­p tÃ i khoáº£n vÃ  máº­t kháº©u GitHub. Náº¿u sá»­ dá»¥ng SSH, chÃºng ta cáº§n pháº£i cung cáº¥p cho GitHub khÃ³a cÃ´ng khai cá»§a mÃ¬nh (trong má»¥c Settings &gt; SSH and GPG keys). Sau Ä‘Ã³, má»—i khi push, pullâ€¦ thay vÃ¬ pháº£i nháº­p tÃ i khoáº£n vÃ  máº­t kháº©u GitHub, chÃºng ta chá»‰ cáº§n nháº­p máº­t kháº©u cá»§a khÃ³a bÃ­ máº­t (passphrase), hoáº·c khÃ´ng cáº§n pháº£i gÃµ thÃªm gÃ¬ náº¿u báº¡n khÃ´ng setup passphrase khi táº¡o khÃ³a. GitHub sá»­ dá»¥ng khÃ³a cÃ´ng khai Ä‘á»ƒ xÃ¡c thá»±c xem ta lÃ  ai vÃ  cÃ³ quyá»n Ä‘á»c/ghi repository hay khÃ´ng vÃ  cháº¥p nháº­n hoáº·c tá»« chá»‘i cÃ¢u lá»‡nh cá»§a chÃºng ta. RÃµ rÃ ng cÃ¡ch 2 tiá»‡n hÆ¡n vÃ¬ chÃºng ta Ä‘á»¡ pháº£i nháº­p dá»¯ liá»‡u. Trong trÆ°á»ng há»£p khÃ´ng cÃ³ passphrase, quÃ¡ trÃ¬nh push/pull repository cÃ³ thá»ƒ Ä‘Æ°á»£c hoÃ n thÃ nh báº±ng viá»‡c cháº¡y script. Äiá»u nÃ y cho phÃ©p ta tá»± Ä‘á»™ng hÃ³a viá»‡c deploy code lÃªn server. Cáº¥u hÃ¬nh SSHÄá»ƒ cáº¥u hÃ¬nh SSH, chÃºng ta sáº½ lÃ m viá»‡c vá»›i thÆ° má»¥c .ssh. ÄÃ¢y lÃ  thÆ° má»¥c chá»©a cÃ¡c file quan trá»ng Ä‘á»ƒ sá»­ dá»¥ng giao thá»©c SSH : authorized_keys, known_hosts vÃ  config. DÆ°á»›i Ä‘Ã¢y mÃ¬nh xin giáº£i thÃ­ch Ã½ nghÄ©a cá»§a tá»«ng file : authorized_keys : trong file nÃ y chá»©a danh sÃ¡ch cÃ¡c khÃ³a cÃ´ng khai cá»§a nhá»¯ng ngÆ°á»i cÃ³ thá»ƒ truy cáº­p vÃ o há»‡ thá»‘ng.Khi má»™t ngÆ°á»i káº¿t ná»‘i tá»›i server, tin nháº¯n Ä‘Æ°á»£c mÃ£ hÃ³a bá»Ÿi khÃ³a bÃ­ máº­t cá»§a há» sáº½ Ä‘Æ°á»£c giáº£i mÃ£ bá»Ÿi láº§n lÆ°á»£t cÃ¡c khÃ³a cÃ´ng khai trong authorized_keys. Náº¿u má»™t trong sá»‘ cÃ¡c khÃ³a cÃ´ng khai nÃ y cÃ³ thá»ƒ giáº£i mÃ£ thÃ nh cÃ´ng thÃ¬ ngÆ°á»i Ä‘Ã³ sáº½ Ä‘Æ°á»£c cho phÃ©p káº¿t ná»‘i vÃ o server. Váº­y, náº¿u báº¡n muá»‘n truy cáº­p vÃ o user user cá»§a server server sá»­ dá»¥ng giao thá»©c SSH, báº¡n chá»‰ cáº§n thÃªm khÃ³a cÃ´ng khai cá»§a mÃ¬nh vÃ o file authorized_keys trong thÆ° má»¥c .ssh cá»§a user user. Äiá»u nÃ y vá» máº·t báº£n cháº¥t cÅ©ng giá»‘ng nhÆ° khi báº¡n thÃªm khÃ³a cÃ´ng khai vÃ o tÃ i khoáº£n GitHub cá»§a mÃ¬nh. known_hosts : trong file nÃ y chá»©a danh sÃ¡ch cÃ¡c host báº¡n Ä‘Ã£ truy cáº­p. CÃ¡c thÃ´ng tin trong file giÃºp mÃ¡y tÃ­nh kiá»ƒm tra danh tÃ­nh host mÃ  nÃ³ Ä‘ang káº¿t ná»‘i Ä‘á»ƒ cháº¯c cháº¯n ráº±ng nÃ³ Ä‘ang káº¿t ná»‘i tá»›i Ä‘Ãºng nÆ¡i, trÃ¡nh viá»‡c bá»‹ káº» xáº¥u redirect káº¿t ná»‘i vÃ o mÃ¡y cá»§a há». config : file nÃ y chá»©a cÃ¡c thiáº¿t láº­p SSH. Khi chÃºng ta sá»­ dá»¥ng má»™t káº¿t ná»‘i SSH thÆ°á»ng xuyÃªn, chÃºng ta cÃ³ thá»ƒ lÆ°u cÃ¡c tham sá»‘ cá»§a káº¿t ná»‘i Ä‘Ã³ vÃ o file nÃ y. CÃ¢u lá»‡nh SSH sáº½ Ä‘Æ°á»£c rÃºt ngáº¯n hÆ¡n.VÃ­ dá»¥, khi báº¡n lÆ°u Ä‘oáº¡n text dÆ°á»›i Ä‘Ã¢y vÃ o file ~/.ssh/config 1234Host alias HostName hostname User username IdentityFile ~/.ssh/private_key ThÃ¬ cÃ¢u lá»‡nh ssh alias sáº½ tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i ssh username@hostname -i ~/.ssh/private_key MÃ¬nh sá»­ dá»¥ng file config nÃ y khi cáº§n pháº£i thiáº¿t láº­p má»™t tÃ i khoáº£n GitLab thá»© 2. CÃ¡c báº¡n cÃ³ thá»ƒ xem chi tiáº¿t táº¡i Ä‘Ã¢y. Má»™t vÃ­ dá»¥ vá» viá»‡c váº­n dá»¥ng lÃ½ thuyáº¿t Ä‘á»ƒ giáº£i quyáº¿t lá»—iTrong pháº§n nÃ y, mÃ¬nh xin giá»›i thiá»‡u má»™t lá»—i hay gáº·p khi lÃ m viá»‡c vá»›i SSH vÃ  cÃ¡ch giáº£i quyáº¿t. Báº¡n sáº½ tháº¥y pháº§n kiáº¿n thá»©c cÆ¡ báº£n cÃ³ Ã­ch cho chÃºng ta nhÆ° tháº¿ nÃ o. Báº¡n cÃ³ tháº¥y cÃ¡i thÃ´ng bÃ¡o nÃ y quen quen khÃ´ng ? ÄÃ¢y lÃ  lá»—i hay gáº·p khi chÃºng ta copy khÃ³a bÃ­ máº­t tá»« mÃ¡y nÃ y sang mÃ¡y khÃ¡c sau Ä‘Ã³ sá»­ dá»¥ng SSH ngay. NhÆ° trong pháº§n lÃ½ thuyáº¿t mÃ¬nh Ä‘Ã£ Ä‘á» cáº­p, khÃ³a bÃ­ máº­t lÃ  cá»§a riÃªng má»—i ngÆ°á»i vÃ  khÃ´ng Ä‘Æ°á»£c chia sáº» cho báº¥t ká»³ ai. Trong hÃ¬nh, khÃ³a cÃ³ permission lÃ  644, cÃ³ nghÄ©a lÃ  má»i ngÆ°á»i cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c ná»™i dung cá»§a khÃ³a, vi pháº¡m nguyÃªn táº¯c cá»§a khÃ³a bÃ­ máº­t dáº«n Ä‘áº¿n lá»—i. Váº¥n Ä‘á» Ä‘Ã£ rÃµ, ta cáº§n giá»›i háº¡n permission cá»§a khÃ³a. Ta cÃ³ thá»ƒ cÃ¢n nháº¯c giá»¯a 400 hoáº·c 600. Xong ! Tá»•ng káº¿tSSH lÃ  má»™t cÃ´ng cá»¥ mÃ  mÃ¬nh sá»­ dá»¥ng khÃ¡ thÆ°á»ng xuyÃªn trong cÃ´ng viá»‡c. LÃºc ban Ä‘áº§u mÃ¬nh cÅ©ng lÃªn máº¡ng copy nhá»¯ng Ä‘oáº¡n lá»‡nh vá» dÃ¡n vÃ o terminal Ä‘á»ƒ cháº¡y nhÆ°ng mÃ¬nh khÃ´ng náº¯m rÃµ báº£n cháº¥t. Khi pháº£i cáº¥u hÃ¬nh nhá»¯ng trÆ°á»ng há»£p phá»©c táº¡p hÆ¡n hay gáº§n Ä‘Ã¢y lÃ m viá»‡c vá»›i GitLab CI/CD thÃ¬ mÃ¬nh ráº¥t lÃºng tÃºng. Sau khi há»‡ thá»‘ng láº¡i, mÃ¬nh dá»… dÃ ng nhÃ¬n ra má»‘i liÃªn há»‡ cháº·t cháº½ giá»¯a kiáº¿n thá»©c cÆ¡ báº£n vÃ  á»©ng dá»¥ng trong thá»±c táº¿. Hiá»ƒu rÃµ Ä‘Æ°á»£c Ä‘iá»u nÃ y giÃºp mÃ¬nh tá»± tin hÆ¡n khi lÃ m viá»‡c. Hi vá»ng bÃ i viáº¿t nÃ y cÃ³ Ã­ch vá»›i báº¡n Ä‘á»c. Háº¹n gáº·p láº¡i !","link":"/2019/12/21/SSHKienthuccobanvaungdung/"}],"tags":[{"name":"NodeJS","slug":"NodeJS","link":"/tags/NodeJS/"},{"name":"SSH","slug":"SSH","link":"/tags/SSH/"},{"name":"CI/CD","slug":"CI-CD","link":"/tags/CI-CD/"}],"categories":[{"name":"IT","slug":"IT","link":"/categories/IT/"},{"name":"Backend","slug":"IT/Backend","link":"/categories/IT/Backend/"},{"name":"DevOps","slug":"IT/DevOps","link":"/categories/IT/DevOps/"}]}