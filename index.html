<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Khoa&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Khoa&#39;s blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Khoa&#39;s blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Khoa&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Khoa&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2namnodejs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/03/2namnodejs/" class="article-date">
  <time datetime="2019-11-03T10:35:01.716Z" itemprop="datePublished">2019-11-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/03/2namnodejs/">Tóm tắt 2 năm sử dụng NodeJS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Giai-doan-1-Tiep-can"><a href="#Giai-doan-1-Tiep-can" class="headerlink" title="Giai đoạn 1 : Tiếp cận."></a>Giai đoạn 1 : Tiếp cận.</h2><p>Mình bắt đầu sử dụng NodeJS vào học kỳ 1 năm 5 đại học. Nền tảng lập trình Web của mình trước khi tiếp cận NodeJS : </p>
<ul>
<li>Về thực hành, thực tập với ASP.NET 1 tháng rưỡi vào cuối năm 3. 2 project PHP ở trường đại học. </li>
<li>Về lý thuyết, mình nắm (sơ sơ) các khái niêm cơ bản : client, server, giao thức http. Biết code HTML, CSS và JavaScript.</li>
</ul>
<p>Khi tiếp xúc với NodeJS, cảm nhận đầu tiên của mình là nó dễ tiếp cận hơn ASP.NET, thực tập năm 3 có được sử dụng ASP.NET và thấy nó hơi khó tiếp cận (trình độ lúc đó kém) ngoài ra Visual Studio khá nặng và phần cấu hình chỉnh chỉnh cái file xml  thì hoàn toàn không hiểu gì.</p>
<p>Một điểm nữa là để thực thi chương trình (webserver) chỉ cần gõ 1 lệnh “node app.js” là nó tự chạy, không cần phải cài đặt server, phần này làm mình khá thích vì mỗi lần đụng đến cấu hình hay cài đặt một cái gì đó thì mình khá e ngại. </p>
<p>Dần dần mình nhận ra những điểm lợi khác của NodeJS</p>
<ul>
<li>Dùng code JS cả frontend và backend =&gt; không cần phải học thêm một ngôn ngữ phía server.</li>
<li>Để viết 1 app đơn giản thì rất nhanh, không cần phải thiết kế class với các nguyên tắc của lập trình hướng đối tượng.</li>
<li>Ngoài việc code logic của ứng dụng, những phần còn lại thì hầu hết đều có một module trên npm có thể cài đặt và sử dụng rất dễ dàng, từ quản lý session, cho phép request cross domain,… và nhiều chức năng khác. Mình cảm thấy rất tiện.</li>
</ul>
<p>(Phần này mình không có ý dìm hàng các công nghệ khác, quan điểm cá nhân là với một người không có nhiều kinh nghiệm về web thì NodeJS khá là dễ tiếp cận)</p>
<h2 id="Giai-doan-2-Gap-rac-roi"><a href="#Giai-doan-2-Gap-rac-roi" class="headerlink" title="Giai đoạn 2 : Gặp rắc rối."></a>Giai đoạn 2 : Gặp rắc rối.</h2><p>Sau khi học NodeJS được 1 học kỳ, bắt đầu đi thực tập và sử dụng NodeJS. Ở giai đoạn này, mình vẫn dùng style code được học trên trường để viết code.</p>
<p>Công ty mình thực tập là 1 startup, mình được giao công việc và hướng dẫn khi gặp khó khăn, mục tiêu là hoàn thành sản phẩm nhanh chóng nên không có nhiều code review. Mình code khá tự do. Bây giờ nhìn lại thì thấy thiếu sót của mình ở giai đoạn này là không lên mạng tìm hiểu xem người ta đang sử dụng NodeJS như thế nào.</p>
<p>Theo thời gian, những chức năng được thêm vào, project ngày càng lớn dần lên. Mối liên hệ giữa các thành phần trong project ngày càng trở nên rối rắm hơn.<br>Mình cảm thấy project của mình không có một chuẩn, qui tắc nào, và bắt đầu trở nên khó quản lý theo thời gian. Ở mức thấp hơn, code nhìn xấu với nhiều hàm callback lồng nhau. Mình bắt đầu tìm hiểu trên mạng những “best practices” cho NodeJS (và cả những vấn đề khác liên quan tới việc viết API). Mình tìm thấy trang <a href="https://github.com/goldbergyoni/nodebestpractices" target="_blank" rel="noopener">https://github.com/goldbergyoni/nodebestpractices</a> tập hợp rất nhiều những « best practices » hữu ích khi làm việc với NodeJS. Từ cấu trúc project, xử lý lỗi, cách viết code,… tất cả đều được tập hợp trong một link duy nhất, một link duy nhất 😊.</p>
<p>Khi xem các bài viết trong trang này, mình thấy code của mình đụng đến khá nhiều những điểm sai sót, những điểm lớn mà mình nhớ là : </p>
<ul>
<li><strong>Cấu trúc project theo lớp</strong> : mình chia file theo lớp, lớp route, lớp logic và lớp access database. Thật ra lúc ban đầu mình không hề nhận ra điều này, chỉ sau khi project lớn dần lên và mình liên tục phải kéo chuột lên xuống để tìm file thì thấy rất bất tiện</li>
<li><strong>Callback hell</strong> : ban đầu mình sử dụng callback, đây là cách mình được học trong trường. Lúc đó mình dùng callback thì cũng không cảm thấy có vấn đề gì. Cho đến khi project của mình ngày càng có nhiều business phức tạp thì một hàm của mình chứa rất nhiều callback, mà mỗi lần callback thì code nó bị thụt vào trong nên rất khó coi. Đỉnh điểm mình nhớ có một hàm nó tụt vào gần giữa trang code</li>
</ul>
<p>Nếu bạn đang sử dụng NodeJS và làm 2 điều này thì nên thay đổi ngay, đừng như mình 😊 </p>
<p>Và còn nhiều điểm khác, ngoài ra project mình còn có những lỗi sau, liên quan tới việc viết API : </p>
<ul>
<li>Về việc sử dụng phương thức http<br>Thời gian đó project của mình chỉ có 2 method : get và post. Get để lấy thông tin từ server, Post để server làm gì đó với thông tin được post. Mình lên mạng tìm hiểu các phương thức của http, ngoài get và post còn có put, delete, head, option… Sau đó mình nghiên cứu và sử dụng thêm put và delete. </li>
<li>Về việc đặt tên cho API<br>Thời gian đầu đi làm mình hay đặt tên api dạng /createuser, /modifyuser, /deleteuser<br>Sau khi tìm đọc về cách đặt tên API, mình rút ra một bài học là không nên để các động từ như create/modify/delete/get vào trong api, tên phương thức http sẽ thể hiện thông tin đó. Ví dụ : </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Get /users/id : get user bằng id</span><br><span class="line">Get /users?query: get nhiều users, có thể sử dụng query</span><br><span class="line">Post /users : tạo một user</span><br><span class="line">Put /user : update thông tin một user</span><br><span class="line">Delete /user : xóa user</span><br></pre></td></tr></table></figure>
<p>Theo cách này tên của các api sẽ đơn giản và nhất quán hơn.</p>
<h2 id="Giai-doan-3-Cap-nhat-kien-thuc-moi"><a href="#Giai-doan-3-Cap-nhat-kien-thuc-moi" class="headerlink" title="Giai đoạn 3 : Cập nhật kiến thức mới"></a>Giai đoạn 3 : Cập nhật kiến thức mới</h2><p>Lại nói về project NodeJS của mình, tại thời điểm đọc được những best practices thì project này cũng đã tương đối to để mình có thể refactor nên mình không refactor code cũ. Tuy nhiên mình sẽ viết những code mới theo các best practices đã đọc. Tương ứng với 2 (trong số rất nhiều) lỗi mà mình đã phạm ở giai đoạn 2, mình áp dụng kiến thức mới.</p>
<ul>
<li><p>Cấu trúc project : với một tính năng mới được thêm vào project, mình sẽ tạo một thư mục mới chứa toàn bộ file liên quan đến tính năng đó ở các tầng khác nhau. Ví dụ, khi thêm tính năng quản lý người dùng thì mình sẽ tạo một thư mục user chứa các file : user.service, user.data, user.test, user.route.</p>
</li>
<li><p>Coding style : mình sử dụng async/await. 2 từ khóa này giúp việc viết code bất đồng bộ trở nên dễ dàng hơn nhiều. Code bất đồng bộ sử dụng 2 từ khóa này trông giống y như một đoạn code đồng bộ thông thường.</p>
</li>
</ul>
<p>Tới thời điểm này, sau 2 năm sử dụng NodeJS, mình thực hiện một project nho nhỏ để cài đặt tất cả những best practices mà mình thấy hữu dụng nhất và sử dụng nó như một template cho các project NodeJS sau này của mình. Những best practices đó là : </p>
<ol>
<li>Chia project theo chức năng (như mình đã nói ở trên). </li>
<li>Ngăn cách rõ các tầng trong project.<br>Ví dụ, nếu ở tầng route mình truyền thẳng 2 biến req và res vào tầng business thì mình đã tạo ra sự phụ thuộc của tầng business vào tầng route. Điều này làm cho việc test code business trở nên khó khăn. Thay vào đó, tại tầng route, mình chỉ lựa những trường nào cần thiết để truyền vào, thương là các trường trong req.body hoặc là req.params.<br>Một điểm mà mình hay thấy ở các project NodeJS trên Github là, tại tầng model, họ sẽ export ra model để tầng Business sử dụng. Tầng business có thể sử dụng các method find, findOne, findOneAndUpdate được xây dựng sẵn trong thư viện Mongoose. Suy nghĩ của mình có hơi khác, mình sẽ viết các hàm truy xuất dữ liệu tại tầng model. Mình thấy có 2 điểm lợi chính để mình giữ cách viết này mặc dù nhìn khá thừa thãi và tốn công code.</li>
</ol>
<ul>
<li>Thứ nhất, nếu api của Mongoose có sự thay đổi thì mình chỉ thay đổi trong tầng model</li>
<li>Thứ hai, mình giới hạn được những method mà tầng Business có thể sử dụng</li>
</ul>
<ol start="3">
<li>Sử dụng thư viện logger thay cho console.log<br>Console.log rất quan trọng vì nó cung cấp thông tin của chương trình. Console.log những điểm quan trọng trong chương trình với một style rõ ràng giúp ích rất nhiều trong quá trình debug cũng như phát hiện điều bất thường khi server hoạt động. </li>
<li>Viết unit test<br>Theo sách clean code, test enables all the -ilities. Vì nó cho phép chúng ta thay đổi, chỉnh sửa code. Một ngày nào đó bạn thấy coding style rất là xấu và bạn muốn refactor, hoặc một tính năng nào đó trong chương trình cần phải cập nhật theo yêu cầu mới. Nếu bạn có sẵn các test thì việc thay đổi code sẽ không làm bạn lo lắng xem nó có ảnh hưởng tới những phần khác của chương trình hay không. Chỉ cần vượt qua các test là xong 😊.  </li>
<li>Cấu trúc api<br>Nếu mình sử dụng các api viết trong file user.route với prefix /users thì trong file này thay vì phải viết /users/id mình chỉ cần viết /id. Điều này cho phép mình có một cấu trúc api nhiều tầng (nhiều /) và tránh sự lặp lại không cần thiết.</li>
</ol>
<h3 id="Chiem-nghiem"><a href="#Chiem-nghiem" class="headerlink" title="Chiêm nghiệm"></a>Chiêm nghiệm</h3><p>Lý do mình viết bài này là vì một câu nói của chú Nguyễn Hữu Thái Hòa trong một video mình coi trên youtube. “Học thì học rất nhiều nhưng mà ngộ (wisdom) ra được cái gì mới là quan trọng”. Mình viết bài này để đóng gói lại 2 năm sử dụng NodeJS, từ giai đoạn tiếp cận, tới những rắc rối cho đến việc cập nhật kiến thức mới để sử dụng công nghệ này “chuẩn” hơn. Cần phải nói một điều, giai đoạn 2 và 3 ở bên trên diễn ra tuần hoàn chớ không tuần tự. Khi mình suy nghĩ tới những công nghệ khác mình sử dụng khi đi làm : AngularJS và MongoDB, bỗng nhiên mình thấy có những điểm hoàn toàn tương tự với NodeJS. Mình cũng bắt đầu tiếp cận các công nghệ này với sự hứng khởi vì chúng có những điểm tốt hơn so với những thứ mình đã sử dụng trước đó (JS thuần với AngularJS, MySQL  với MongoDB) sau đó gặp rắc rối trong quá trình sử dụng và rồi lại cập nhật kiến thức mới để giải quyết những rắc rối gặp phải. Mình rút ra một kết luận mà ai cũng biết đó là việc học hỏi, cập nhật cái mới cần diễn ra một cách liên tục. Nhưng giờ, với những gì mình đã trải qua, mình đã hiểu sâu sắc lý do của việc đó. Nếu chúng ta không cập nhật cái mới thì sớm muộn chúng ta sẽ “gặp rắc rối”.<br>Thế cái này mà đem vào chuyện hôn nhân gia đình thì sao nhỉ ? :D. Các bạn tự có câu trả lời hợp lý nhé :v.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/03/2namnodejs/" data-id="ck2j5r51300008wuqfd5db6qc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/11/03/2namnodejs/">Tóm tắt 2 năm sử dụng NodeJS</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 DINH Dang Khoa<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>